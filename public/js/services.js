// Generated by CoffeeScript 2.0.0-beta7
angular.module('app').service('todoDAO', function ($resource, todoList) {
  var todos;
  todos = $resource('/todo/:id', { id: '@id' });
  this.save = function (todo, skip) {
    var entity;
    entity = new Todo(todo.id, todo.title, todo.date, todo.priority, todo.done);
    if (!skip) {
      entity = todos.save(entity);
      if (null != todo.id && !todoList.items.filter(function (it) {
          return it.id === todo.id;
        }).length)
        return todoList.items.unshift(entity);
    } else if (!todoList.items.filter(function (it) {
        return it.id === todo.id;
      }).length) {
      return todoList.items.unshift(entity);
    }
  };
  this.update = function (todo, skip) {
    var entity, item;
    entity = new Todo(todo.id, todo.title, todo.date, todo.priority, todo.done);
    if (!skip)
      entity = todos.save(entity);
    item = todoList.items.filter(function (it) {
      return it.id === entity.id;
    })[0];
    item.title = entity.title;
    item.date = entity.date;
    item.priority = entity.priority;
    return item.done = entity.done;
  };
  this.remove = function (todo, skip) {
    todoList.items = todoList.items.filter(function (it) {
      return it.id !== todo.id;
    });
    if (!skip)
      return todos.remove({ id: todo.id });
  };
  this.list = function () {
    todoList.items = todos.query();
    return todoList.items;
  };
  return this;
}).service('todoList', function () {
  this.items = [];
  return this;
}).service('sync', function (todoDAO, $rootScope) {
  this.connect = function () {
    this.socket = io.connect('/');
    this.socket.emit('ready');
    return this.socket.on('upd', this.handle);
  };
  this.handle = function (response) {
    if (!response.data)
      return;
    switch (response.action) {
    case 'create':
      todoDAO.save(response.data, true);
      break;
    case 'remove':
      todoDAO.remove(response.data, true);
      break;
    case 'update':
      todoDAO.update(response.data, true);
    }
    return $rootScope.$digest();
  };
  return this;
});

//# sourceMappingURL=services.js.map
