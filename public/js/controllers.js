// Generated by CoffeeScript 2.0.0-beta7
void function () {
  var MS_IN_DAY;
  MS_IN_DAY = 1e3 * 60 * 60 * 24;
  angular.module('app').controller('SortCtrl', function ($scope, $routeParams) {
    if (null != $scope.current)
      $scope.current;
    else
      $scope.current = { sort: {} };
    $scope.current.sort.mode = $routeParams.mode || 'id';
    $scope.current.sort.dir = $routeParams.dir || 'desc';
    return this;
  }).controller('LoginCtrl', function ($scope, $location, $http, sync) {
    $scope.login = function () {
      if (!$scope.authform.$valid)
        return;
      $scope.error = null;
      console.log('login');
      return $http.post('/login', $scope.current.user).success(function (user, status) {
        user.isAuthenticated = true;
        console.log(user);
        $scope.current.user = user;
        sync.connect();
        return $location.path('/');
      }).error(function (data, status) {
        return $scope.error = 'Wrong username or password';
      });
    };
    return $scope.register = function () {
      if (!$scope.authform.$valid)
        return;
      $scope.error = null;
      console.log('reg');
      return $http.post('/register', $scope.current.user).success(function (user, status) {
        user.isAuthenticated = true;
        console.log(user);
        $scope.current.user = user;
        sync.connect();
        return $location.path('/');
      }).error(function (data, status) {
        return $scope.error = data.msg;
      });
    };
  }).controller('LogoutCtrl', function ($scope, $http, $location) {
    $http.get('/logout');
    $scope.current.user = {};
    return $location.path('/login');
  }).controller('MainCtrl', function ($scope, $rootScope, $location, $http, todoDAO, todoList, inputParser, sync) {
    var watcher;
    if (null != $scope.current)
      $scope.current;
    else
      $scope.current = { sort: {} };
    if (null != $scope.current.user)
      $scope.current.user;
    else
      $scope.current.user = {};
    $http.get('/user').success(function (user) {
      console.log(user);
      user.isAuthenticated = true;
      $scope.current.user = user;
      return sync.connect();
    }).error(function (data) {
      return $location.path('/login');
    });
    $scope.current.todoList = todoDAO.list();
    watcher = function () {
      console.log(todoList.items);
      return todoList.items;
    };
    $rootScope.$watch(watcher, function (old, newval) {
      if (old === newval)
        return;
      return $scope.current.todoList = todoList.items;
    }, true);
    $scope.submitTodo = function (input) {
      var todo;
      todo = inputParser.parse(input);
      if ($scope.current.addform.$valid) {
        todoDAO.save(todo);
        $scope.current.input = '';
        return $scope.current.addform.$setPristine();
      }
    };
    $scope.updateTodo = function (todo, input) {
      var upd;
      upd = inputParser.parse(input);
      todo.title = upd.title;
      todo.date = upd.date;
      todo.priority = upd.priority;
      todo.editMode = false;
      return todoDAO.update(todo);
    };
    $scope.deleteTodo = function (id) {
      return todoDAO.remove({ id: id });
    };
    $scope.editMode = function (todo) {
      if (!todo.done)
        return todo.editMode = true;
    };
    $scope.markDone = function (todo, status) {
      todo.done = status;
      return todoDAO.save(todo);
    };
    $scope.sort = function () {
      return console.log('sort');
    };
    $scope.dueDays = function (date) {
      return (date - new Date().getTime()) / MS_IN_DAY;
    };
    return this;
  });
}.call(this);

//# sourceMappingURL=controllers.js.map
